version: 1

AppDir:
  path: ./AppDir

  app_info:
    id: com.github.nidra
    name: NIDRA
    icon: NIDRA
    version: 0.1.0
    exec: usr/bin/python3
    exec_args: "-m NIDRA.nidra_gui.launcher"

  apt:
    arch: amd64
    sources:
      - sourceline: deb http://archive.ubuntu.com/ubuntu/ jammy main restricted
      - sourceline: deb http://archive.ubuntu.com/ubuntu/ jammy-updates main restricted
      - sourceline: deb http://archive.ubuntu.com/ubuntu/ jammy universe
      - sourceline: deb http://archive.ubuntu.com/ubuntu/ jammy-updates universe
      - sourceline: deb http://archive.ubuntu.com/ubuntu/ jammy multiverse
      - sourceline: deb http://archive.ubuntu.com/ubuntu/ jammy-updates multiverse
      - sourceline: deb http://archive.ubuntu.com/ubuntu/ jammy-backports main restricted universe multiverse
      - sourceline: deb http://security.ubuntu.com/ubuntu jammy-security main restricted
      - sourceline: deb http://security.ubuntu.com/ubuntu jammy-security universe
      - sourceline: deb http://security.ubuntu.com/ubuntu jammy-security multiverse
    include:
      - python3
      - python3-pip
      - python3-venv
    exclude: []
  build:
    - cp -r $RECIPE_DIR/NIDRA ./usr/src/
    - cp $RECIPE_DIR/pyproject.toml ./usr/src/
    - python3 -m pip install ./usr/src
    - cp $RECIPE_DIR/NIDRA/nidra_gui/neutralino/resources/icons/appIcon.png .
    - mv ./appIcon.png ./NIDRA.png
    
  runtime:
    env:
      APPIMAGE_EXTRACT_AND_RUN: 1
      PATH: usr/bin:${PATH}
      PYTHONHOME: usr
      PYTHONPATH: usr/lib/python3.11/site-packages:usr/lib/python3.11:usr/src

  test:
    fedora:
      image: appimagecrafters/tests-fedora:30
      command: ./NIDRA-x86_64.AppImage --appimage-help
    arch:
      image: appimagecrafters/tests-arch:latest
      command: ./NIDRA-x86_64.AppImage --appimage-help
    debian:
      image: appimagecrafters/tests-debian:stable
      command: ./NIDRA-x86_64.AppImage --appimage-help
    centos:
      image: appimagecrafters/tests-centos:7
      command: ./NIDRA-x86_64.AppImage --appimage-help
    ubuntu:
      image: appimagecrafters/tests-ubuntu:xenial
      command: ./NIDRA-x86_64.AppImage --appimage-help

AppImage:
  arch: x86_64
  update-information: gh-releases-zsync|nidra-project|NIDRA|latest|NIDRA-*x86_64.AppImage.zsync
  sign-key: None
